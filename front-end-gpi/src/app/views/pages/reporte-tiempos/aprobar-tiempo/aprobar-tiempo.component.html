<nav class="page-breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a routerLink="/proyectos">Proyectos</a></li>
        <li class="breadcrumb-item">
            <a routerLink="/reporte-tiempo/horas-reportadas">Reportes</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">Pendientes</li>
    </ol>
</nav>

<div class="row">
    <div class="col-md-12 stretch-card">
        <div class="card">
            <div class="card-body">
                <h6 class="card-title">Aprobación de Tiempos</h6>
                <hr />
                <form (ngSubmit)="search()">
                    <div class="form-row">
                        <div class="form-group col-12 d-flex justify-content-between align-items-end">
                            <a (click)="openAddRecursosModal(addRecurso)" class="text-primary font-weight-bold">
                                <div *ngIf="recursosAgregados.length == 0">Seleccionar Recursos</div>
                                <div *ngIf="recursosAgregados.length == 1">{{recursosAgregados.length}} recurso seleccionado.</div>
                                <div *ngIf="recursosAgregados.length > 1">{{recursosAgregados.length}} recursos seleccionados.</div>
                            </a>
                            <a (click)="quitarRecursos()" class="font-weight-bold" placement="top" ngbTooltip="Quitar recursos" *ngIf="recursosAgregados.length > 0">
                                X
                            </a>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-6 col-md-2">
                            <button type="submit" class="btn btn-primary" (click)="searchRecursoByName()">
                                BUSCAR
                            </button>
                        </div>
                        <div class="form-group col-6">
                            <button type="button" class="btn btn-primary" (click)="aprobacionMasiva()">
                                APROBACIÓN MASIVA
                            </button>
                        </div>
                    </div>
                </form>
                <div class="alert alert-info" role="alert" *ngIf="reportes.length == 0">
                    No se encontraron Reportes Pendientes.
                </div>

                <div class="table-responsive" id="ex" *ngIf="reportes.length > 0">
                    <table class="table table-hover" style="width: 100%">
                        <thead>
                            <tr>
                                <th scope="col">checkbox</th>
                                <th scope="col">Fecha</th>
                                <th scope="col">Proyecto</th>
                                <th scope="col">Actividad</th>
                                <th scope="col">Recurso</th>
                                <th scope="col">Horas</th>
                                <th scope="col">Scotia Id</th>
                                <th scope="col">Director designado</th>
                                <th scope="col">RF proyecto</th>
                                <th scope="col">Asignado por</th>
                                <th scope="col">Estado</th>
                                <th scope="col">Opciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let r of reportes">
                                <td>
                                    <input [(ngModel)]="r.checked" type="checkbox" name="recurso_checkbox" id="checked"
                                        class="form-control mr-4" />
                                </td>
                                <td class="text-uppercase" scope="row">
                                    {{ r.fecha | date : "dd-MMM-yyyy" }}
                                </td>
                                <td id="nombre_proyecto">
                                    {{ r.proyecto.nombre }}-{{ r.proyecto.descripcion }}
                                </td>
                                <td class="w-50 text-wrap">{{ r.actividad.actividad.actividad }}</td>
                                <td class="w-50 text-wrap">{{ r.empleado.nombre }}</td>
                                <td>{{ r.horas }}</td>

                                <td class="w-50 text-wrap">{{ r.empleado.scotiaID }}</td>
                                <td class="w-50 text-wrap">{{ r.proyecto.directorClient }}</td>
                                <td>{{ r.proyecto.rfProyecto }}</td>

                                <td class="w-50 text-wrap">{{ r.asignador }}</td>
                                <td>
                                    <span class="badge" [ngClass]="{
                      'badge-success': r.estado.id == 2,
                      'badge-danger': r.estado.id == 3,
                      'badge-warning': r.estado.id == 1
                    }">{{ r.estado.estado }}</span>
                                </td>
                                <td>
                                    <a (click)="detalleReporte(r.id)" class="mdi mdi-24px mdi-account-search"
                                        ngbTooltip="Detalle de reporte"></a>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ADD RECURSO MODAL -->
<ng-template #addRecurso let-d="dismiss">
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Agregar recursos</h4>
        <button type="button" class="close" aria-label="Close" (click)="cancelAgregarRecursoModal()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <div class="alert text-danger border-danger mr-2 alert-dismissible fade show" role="alert" *ngIf="recursosAgregados.length == 0">
            Debe seleccionar almenos un <strong>Recurso</strong> a la lista.
          </div>
        <div class="row">
            <div class="col">
                Recursos disponibles
                <hr>
                <label>Buscar por recurso</label>
                <div class="form-group">
                    <input class="form-control" autocomplete="off" oninput="javascript:this.value=this.value.toUpperCase();" type="text" [(ngModel)]="searchTextR" (keyup)="filtroRecursosDispo()" (keydown)="validarText($event)" placeholder="Ingrese el nombre del recurso">
                </div>
                <div class="alert alert-secondary" id="alert-add-recurso" role="alert" *ngIf="recursos.length > 0">
                    <a class="font-weight-bold" (click)="seleccionarTodo()" placement="right" ngbTooltip="Seleccionar todos">SELECCIONAR TODO</a>
                </div>
                <div class="alert alert-secondary" id="alert-add-recurso" role="alert" *ngFor="let e of recursoFiltro" (click)="agregarRecurso(e)" ngbTooltip="Agregar">
                    <a class="font-weight-bold"  placement="right">{{e.nombre}}</a>
                </div>
            </div>
            <div class="col">
                Recursos agregados
                <hr>
                <div class="alert alert-success" id="alert-add-recurso" role="alert" *ngIf="recursosAgregados.length > 0">
                    <a class="font-weight-bold" (click)="quitarTodo()" placement="right" ngbTooltip="Quitar todos">QUITAR TODO</a>
                </div>
                <div class="alert alert-success" role="alert" *ngFor="let e of recursosAgregados" (click)="quitarRecurso(e)" ngbTooltip="Quitar">
                    <a class="font-weight-bold" placement="right" >{{e.nombre}}</a>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <a id="btnModalRecursoDelete" class="btn btn-primary" (click)="aceptarAgregarRecursoModal()">
            Aceptar
        </a>
        <button id="btnModalRecursoCancelar" type="button" class="btn btn-light" aria-label="Close"
            (click)="cancelAgregarRecursoModal()">
            Cancelar
        </button>
    </div>
</ng-template>